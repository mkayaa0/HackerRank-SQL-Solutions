SELECT S_Name FROM
	(SELECT 
 		 S.ID AS Student_ID,
 		 S.NAME AS S_Name,
 		 P1.SALARY AS Student_Salary,
 		 F.FRIEND_ID AS Friend_ID,
  	   	 P2.SALARY AS Friend_Salary
	FROM FRIENDS F
	LEFT JOIN STUDENTS S
  		ON S.ID = F.ID
	LEFT JOIN PACKAGES P1
 		ON S.ID = P1.ID 
	LEFT JOIN PACKAGES P2
 		ON F.FRIEND_ID = P2.ID
	)
WHERE FRIEND_SALARY - STUDENT_SALARY > 0
ORDER BY FRIEND_SALARY
;