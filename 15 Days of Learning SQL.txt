WITH DAILY_SUBS AS (
    SELECT HACKER_ID, SUBMISSION_DATE, COUNT(*) AS NUM_SUBS
    FROM SUBMISSIONS
    GROUP BY HACKER_ID, SUBMISSION_DATE
),
ALL_DAYS_SUBS AS (
    SELECT SUBMISSION_DATE, HACKER_ID
    FROM (
        SELECT SUBMISSION_DATE, 
               HACKER_ID,
               DENSE_RANK() OVER(ORDER BY SUBMISSION_DATE ASC) AS DAY_NUM, 
               ROW_NUMBER() OVER (PARTITION BY HACKER_ID ORDER BY SUBMISSION_DATE ASC) AS STREAK
        FROM DAILY_SUBS
    ) STREAK_CHECK
    WHERE DAY_NUM = STREAK
),
NUM_ALL_DAY_SUBS AS (
    SELECT SUBMISSION_DATE, COUNT(*) AS NUM_SUBS
    FROM ALL_DAYS_SUBS
    GROUP BY SUBMISSION_DATE
),
DAILY_RANKING AS (
    SELECT SUBMISSION_DATE, HACKER_ID,
           ROW_NUMBER() OVER(PARTITION BY SUBMISSION_DATE 
                             ORDER BY NUM_SUBS DESC, HACKER_ID ASC) AS RANK
    FROM DAILY_SUBS
),
DAILY_WINNERS AS (
    SELECT SUBMISSION_DATE, HACKER_ID
    FROM DAILY_RANKING
    WHERE RANK = 1
)
SELECT ADS.SUBMISSION_DATE, NUM_SUBS, H.HACKER_ID, NAME
FROM NUM_ALL_DAY_SUBS ADS
LEFT JOIN DAILY_WINNERS DW
    ON ADS.SUBMISSION_DATE = DW.SUBMISSION_DATE
LEFT JOIN HACKERS H
    ON DW.HACKER_ID = H.HACKER_ID
ORDER BY ADS.SUBMISSION_DATE ASC;
